var coachApp=angular.module("coachApp",["ngRoute","oc.lazyLoad","requestModule","flash","ngAnimate","angularUtils.directives.dirPagination","ui.bootstrap"]);coachApp.controller("CoachPaymentController",["$scope","requestHandler","Flash","$routeParams",function(a,b,c,d){a.paginationLoad=!1,a.activeClass.payments="active",a.currentPage=1,a.doGetMyCourseListByUser=function(){b.getRequest("coach/listofPublishedCoursePayment/","").then(function(b){a.myCourseList=b.data.courselist,a.paginationLoad=!0},function(){errorMessage(c,"Please try again later!")})},a.doGetCourseTotalEarnings=function(){b.getRequest("coach/totalEarningsInCourse/","").then(function(b){a.totalearnings=b.data.totalearnings},function(){errorMessage(c,"Please try again later!")})},a.doGetMySubscribersListByCourse=function(){a.offset=(a.currentPage-1)*a.itemsPerPage,a.limit=a.currentPage*a.itemsPerPage,a.loaded=!0,void 0==a.subscriberSearch&&(a.subscriberSearch=""),a.params={courseid:d.id,limit:a.limit,offset:a.offset,searchname:a.subscriberSearch,sortid:a.sortId,sorttype:a.sorttype},b.postRequest("coach/courseTransactionHistory/",a.params).then(function(b){a.subscribersList=b.data.purchasehistory,a.total_count=b.data.totalrecordcount,a.loaded=!1},function(){errorMessage(c,"Please try again later!")})},a.sortingCourseSubscriber=function(b){a.sortId=b,a.currentPage=1;var c=a.sortIcon[b];a.sortIcon=["fa fa-caret-up","fa fa-caret-up","fa fa-caret-up","fa fa-caret-up","fa fa-caret-up"],"fa fa-caret-up"==c?(a.sortIcon[b]="fa fa-caret-down",a.sorttype=1):(a.sortIcon[b]="fa fa-caret-up",a.sorttype=2),a.doGetMySubscribersListByCourse()},a.sortingCoachSubscriber=function(b){a.sortId=b,a.currentPage=1;var c=a.sortIcon[b];a.sortIcon=["fa fa-caret-down","fa fa-caret-down","fa fa-caret-down","fa fa-caret-down","fa fa-caret-down"],"fa fa-caret-down"==c?(a.sortIcon[b]="fa fa-caret-up",a.sorttype=2):(a.sortIcon[b]="fa fa-caret-down",a.sorttype=1),a.doGetMySubscribersListByCoach()},a.doViewPaymentDetails=function(d){$(function(){$("#lean_overlay").fadeTo(1e3),$("#paymentView").fadeIn(600),$(".common_model").show()}),a.loaded=!0,b.postRequest("outwardPaymentDetail/",{outwardid:d}).then(function(b){a.paymentDetails=b.data.outwardDetails,a.loaded=!1},function(){errorMessage(c,"Please try again later!")}),$(".modal_close").click(function(){$(".common_model").hide(),$("#paymentView").hide(),$("#lean_overlay").hide()}),$("#lean_overlay").click(function(){$(".common_model").hide(),$("#paymentView").hide(),$("#lean_overlay").hide()})},a.doGetPerCourseTotalEarnings=function(){b.postRequest("coach/totalEarningsbyCourse/",{courseid:d.id}).then(function(b){a.coursetotalearnings=b.data.toatlearnings},function(){errorMessage(c,"Please try again later!")})},a.doGetMySubscribersListByCoach=function(){a.offset=(a.currentPage-1)*a.itemsPerPage,a.limit=a.currentPage*a.itemsPerPage,a.loaded=!0,void 0==a.subscriberSearch&&(a.subscriberSearch=""),a.params={limit:a.limit,offset:a.offset,searchname:a.subscriberSearch,sortid:a.sortId,sorttype:a.sorttype},b.postRequest("coach/coachSubscribedTransactionHistory/",a.params).then(function(b){a.subscribedList=b.data.purchasehistory.purchasedList,a.total_count=b.data.totalrecordcount,a.loaded=!1},function(){errorMessage(c,"Please try again later!")})},a.doGetTotalSubscriptionEarnings=function(){b.getRequest("coach/totalEarningsbySubscription/","").then(function(b){a.subscriptiontotalearnings=b.data.toatlearnings},function(){errorMessage(c,"Please try again later!")})},a.doGetSubscriptionDetails=function(){b.postRequest("coach/detailViewofsubscriptionTransaction/",{paymentid:d.id}).then(function(b){a.outwardDetails=b.data.subscription_transaction_detail.outwarddetail,a.coachDetails=b.data.subscription_transaction_detail.coachdetail,a.userdetail=b.data.subscription_transaction_detail.userdetail},function(){errorMessage(c,"Please try again later!")})},a.courseListInit=function(){a.doGetMyCourseListByUser(),a.doGetCourseTotalEarnings()},a.subscribersListInit=function(){a.itemsPerPage=9,a.subscriberSearch="",a.sortId="",a.sorttype="",a.sortIcon=["fa fa-caret-up","fa fa-caret-up","fa fa-caret-up","fa fa-caret-up","fa fa-caret-up"],a.doGetMySubscribersListByCourse(),a.doGetPerCourseTotalEarnings()},a.SubscriptionList=function(){a.itemsPerPage=9,a.subscriberSearch="",a.sortId="",a.sorttype="",a.sortIcon=["fa fa-caret-down","fa fa-caret-down","fa fa-caret-down","fa fa-caret-down","fa fa-caret-down","fa fa-caret-down"],a.doGetMySubscribersListByCoach(),a.doGetTotalSubscriptionEarnings()},a.courseSortIcons={coursename:"fa fa-caret-down",categoryname:"fa fa-caret-down",publishedon:"fa fa-caret-down",courseamount:"fa fa-caret-down",enrollcount:"fa fa-caret-down",toatlearnings:"fa fa-caret-down"},a.sortBy=function(b){a.sortKey=b,a.reverse=!a.reverse;var c=a.courseSortIcons[b];a.courseSortIcons={coursename:"fa fa-caret-down",categoryname:"fa fa-caret-down",publishedon:"fa fa-caret-down",courseamount:"fa fa-caret-down",enrollcount:"fa fa-caret-down",toatlearnings:"fa fa-caret-down"},"fa fa-caret-down"==c?a.courseSortIcons[b]="fa fa-caret-up":a.courseSortIcons[b]="fa fa-caret-down"},a.studentSubscriptionDetailsInit=function(){a.doGetSubscriptionDetails()}}]),coachApp.filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),coachApp.filter("startsWithLetterCourse",function(){return function(a,b){var c=[],d=new RegExp(b,"i");if(a)for(var e=0;e<a.length;e++){var f=a[e];(d.test(f.coursename)||d.test(f.categoryname))&&c.push(f)}else;return c}});