var coachApp=angular.module("coachApp",["ngRoute","oc.lazyLoad","requestModule","flash","ngAnimate","angularUtils.directives.dirPagination","ui.bootstrap"]);coachApp.controller("CoachPaymentController",["$scope","requestHandler","Flash","$routeParams",function(a,t,e,r){a.paginationLoad=!1,a.activeClass.payments="active",a.currentPage=1,a.doGetMyCourseListByUser=function(){t.getRequest("coach/listofPublishedCoursePayment/","").then(function(t){a.myCourseList=t.data.courselist,a.paginationLoad=!0},function(){errorMessage(e,"Please try again later!")})},a.doGetCourseTotalEarnings=function(){t.getRequest("coach/totalEarningsInCourse/","").then(function(t){a.totalearnings=t.data.totalearnings},function(){errorMessage(e,"Please try again later!")})},a.doGetMySubscribersListByCourse=function(){a.offset=(a.currentPage-1)*a.itemsPerPage,a.limit=a.currentPage*a.itemsPerPage,a.loaded=!0,void 0==a.subscriberSearch&&(a.subscriberSearch=""),a.params={courseid:r.id,limit:a.limit,offset:a.offset,searchname:a.subscriberSearch,sortid:a.sortId,sorttype:a.sorttype},t.postRequest("coach/courseTransactionHistory/",a.params).then(function(t){a.subscribersList=t.data.purchasehistory,a.total_count=t.data.totalrecordcount,a.loaded=!1},function(){errorMessage(e,"Please try again later!")})},a.sortingCourseSubscriber=function(t){a.sortId=t,a.currentPage=1;var e=a.sortIcon[t];a.sortIcon=["fa fa-caret-up","fa fa-caret-up","fa fa-caret-up","fa fa-caret-up","fa fa-caret-up"],"fa fa-caret-up"==e?(a.sortIcon[t]="fa fa-caret-down",a.sorttype=1):(a.sortIcon[t]="fa fa-caret-up",a.sorttype=2),a.doGetMySubscribersListByCourse()},a.sortingCoachSubscriber=function(t){a.sortId=t,a.currentPage=1;var e=a.sortIcon[t];a.sortIcon=["fa fa-caret-down","fa fa-caret-down","fa fa-caret-down","fa fa-caret-down","fa fa-caret-down"],"fa fa-caret-down"==e?(a.sortIcon[t]="fa fa-caret-up",a.sorttype=2):(a.sortIcon[t]="fa fa-caret-down",a.sorttype=1),a.doGetMySubscribersListByCoach()},a.doViewPaymentDetails=function(r){$(function(){$("#lean_overlay").fadeTo(1e3),$("#paymentView").fadeIn(600),$(".common_model").show()}),a.loaded=!0,t.postRequest("outwardPaymentDetail/",{outwardid:r}).then(function(t){a.paymentDetails=t.data.outwardDetails,a.loaded=!1},function(){errorMessage(e,"Please try again later!")}),$(".modal_close").click(function(){$(".common_model").hide(),$("#paymentView").hide(),$("#lean_overlay").hide()}),$("#lean_overlay").click(function(){$(".common_model").hide(),$("#paymentView").hide(),$("#lean_overlay").hide()})},a.doGetPerCourseTotalEarnings=function(){t.postRequest("coach/totalEarningsbyCourse/",{courseid:r.id}).then(function(t){a.coursetotalearnings=t.data.toatlearnings},function(){errorMessage(e,"Please try again later!")})},a.doGetMySubscribersListByCoach=function(){a.offset=(a.currentPage-1)*a.itemsPerPage,a.limit=a.currentPage*a.itemsPerPage,a.loaded=!0,void 0==a.subscriberSearch&&(a.subscriberSearch=""),a.params={limit:a.limit,offset:a.offset,searchname:a.subscriberSearch,sortid:a.sortId,sorttype:a.sorttype},t.postRequest("coach/coachSubscribedTransactionHistory/",a.params).then(function(t){a.subscribedList=t.data.purchasehistory.purchasedList,a.total_count=t.data.totalrecordcount,a.loaded=!1},function(){errorMessage(e,"Please try again later!")})},a.doGetTotalSubscriptionEarnings=function(){t.getRequest("coach/totalEarningsbySubscription/","").then(function(t){a.subscriptiontotalearnings=t.data.toatlearnings},function(){errorMessage(e,"Please try again later!")})},a.doGetSubscriptionDetails=function(){t.postRequest("coach/detailViewofsubscriptionTransaction/",{paymentid:r.id}).then(function(t){a.outwardDetails=t.data.subscription_transaction_detail.outwarddetail,a.coachDetails=t.data.subscription_transaction_detail.coachdetail,a.userdetail=t.data.subscription_transaction_detail.userdetail},function(){errorMessage(e,"Please try again later!")})},a.courseListInit=function(){a.doGetMyCourseListByUser(),a.doGetCourseTotalEarnings()},a.subscribersListInit=function(){a.itemsPerPage=9,a.subscriberSearch="",a.sortId="",a.sorttype="",a.sortIcon=["fa fa-caret-up","fa fa-caret-up","fa fa-caret-up","fa fa-caret-up","fa fa-caret-up"],a.doGetMySubscribersListByCourse(),a.doGetPerCourseTotalEarnings()},a.SubscriptionList=function(){a.itemsPerPage=9,a.subscriberSearch="",a.sortId="",a.sorttype="",a.sortIcon=["fa fa-caret-down","fa fa-caret-down","fa fa-caret-down","fa fa-caret-down","fa fa-caret-down","fa fa-caret-down"],a.doGetMySubscribersListByCoach(),a.doGetTotalSubscriptionEarnings()},a.courseSortIcons={coursename:"fa fa-caret-down",categoryname:"fa fa-caret-down",publishedon:"fa fa-caret-down",courseamount:"fa fa-caret-down",enrollcount:"fa fa-caret-down",toatlearnings:"fa fa-caret-down"},a.sortBy=function(t){a.sortKey=t,a.reverse=!a.reverse;var e=a.courseSortIcons[t];a.courseSortIcons={coursename:"fa fa-caret-down",categoryname:"fa fa-caret-down",publishedon:"fa fa-caret-down",courseamount:"fa fa-caret-down",enrollcount:"fa fa-caret-down",toatlearnings:"fa fa-caret-down"},"fa fa-caret-down"==e?a.courseSortIcons[t]="fa fa-caret-up":a.courseSortIcons[t]="fa fa-caret-down"},a.studentSubscriptionDetailsInit=function(){a.doGetSubscriptionDetails()}}]),coachApp.filter("trusted",["$sce",function(a){return function(t){return a.trustAsResourceUrl(t)}}]),coachApp.filter("startsWithLetterCourse",function(){return function(a,t){var e=[],r=new RegExp(t,"i");if(a)for(var o=0;o<a.length;o++){var s=a[o];(r.test(s.coursename)||r.test(s.categoryname))&&e.push(s)}else;return e}});