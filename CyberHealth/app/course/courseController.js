var userApp=angular.module("userApp",["ngRoute","oc.lazyLoad","ngCookies","requestModule","flash","angularUtils.directives.dirPagination"]);userApp.controller("CourseController",["$scope","requestHandler","Flash","$routeParams","$location",function(e,t,o,s){e.entrolling="Enroll course",e.enrollButtonStatus=!1,e.activeClass.myCourses="active",e.mycourselist=function(){e.loaded=!0,t.getRequest("user/getMyCourseList/","").then(function(t){e.myCourseList=t.data.published_Course,e.loaded=!1},function(){errorMessage(o,"Please try again later!")})},e.courseDetails=function(){e.loaded=!0,t.postRequest("courseDetail/",{courseid:s.id}).then(function(t){e.courseDetails=t.data.coursedetail,e.courseDetails.role="user",e.loaded=!1},function(){errorMessage(o,"Please try again later!")})},e.courseSectionList=function(){t.postRequest("getSectionList/",{courseid:s.id}).then(function(t){e.sectionList=t.data.course},function(){errorMessage(o,"Please try again later!")})},e.courseSectionDetails=function(){t.postRequest("user/sectionDetail/",{sectionid:s.id}).then(function(o){e.sectionDetail=o.data.sectiondetail,t.postRequest("getSectionList/",{courseid:e.sectionDetail.courseid}).then(function(t){e.sectionList=t.data.course,e.sectionLength=e.sectionList.length,$.each(e.sectionList,function(t,o){o.sectionid==s.id&&(e.currentIndex=t,e.sectionno=t+1),1===e.sectionList.length&&(e.nextdisable=!0)})})},function(){errorMessage(o,"Please try again later!")})},e.courseSectionDetailsbyId=function(s){t.postRequest("user/sectionDetail/",{sectionid:s}).then(function(t){e.sectionDetail=t.data.sectiondetail,$.each(e.sectionList,function(t,o){o.sectionid==s&&(e.currentIndex=t,e.sectionno=t+1)})},function(){errorMessage(o,"Please try again later!")})},e.courselist=function(){t.postRequest("getPublishedCourse/",{offset:0,limit:1}).then(function(t){e.showCourseSearch=t.data.published_Course.length},function(){errorMessage(o,"Please try again later!")}),$("#callCarousel").hide(),e.loaded=!0,t.getRequest("getCoursecategory/","").then(function(o){e.allCategory=e.allCategoryCourses=o.data.coursecategory,$.each(e.allCategory,function(o,s){t.postRequest("searchPublishedCourse/",{categoryid:s.categoryid,coursename:"",ownername:""}).then(function(t){e.allCategoryCourses[o].categoryCourses=t.data.published_Course,o==e.allCategory.length-1&&(callCarousel(),window.setTimeout(function(){e.$apply(function(){e.loaded=!1})},900))})})})},e.categoryCourseList=function(){t.postRequest("searchPublishedCourse/",{categoryid:s.id,coursename:"",ownername:""}).then(function(t){e.categoryCourses=t.data.published_Course,e.paginationLoad=!0})},e.doEnrollCourse=function(s){e.entrolling="Enrolling Please Wait",e.enrollButtonStatus=!0,t.postRequest("user/enrollCourse/",{courseid:s,returnUrl:t.paymentURL()+"/#/thanksEnrollPage/"+s,cancelUrl:t.paymentURL()+"/#/courses"}).then(function(e){1==e.data.transactionStatus?window.location=e.data.approveURL.href:2==e.data.transactionStatus&&(window.location=t.paymentURL()+"/#/thanksEnrollPage/"+s)},function(){errorMessage(o,"Please try again later!")})},e.checkenroll=function(){$(function(){$("#lean_overlay").fadeTo(1e3),$("#enrollmodal").fadeIn(600),$(".common_model").show()}),$(".modal_close").click(function(){$(".common_model").hide(),$("#enrollmodal").hide(),$("#lean_overlay").hide()}),$("#lean_overlay").click(function(){$(".common_model").hide(),$("#enrollmodal").hide(),$("#lean_overlay").hide()})},e.nextdisable=!1,e.prevdisable=!0,e.getNextIndex=function(){t.postRequest("getSectionList/",{courseid:e.sectionDetail.courseid}).then(function(o){e.sectionList=o.data.course;var s=e.currentIndex+1;e.sectionno=s+1,s===e.sectionList.length-1&&(e.nextdisable=!0),e.sectionList=o.data.course[s],t.postRequest("user/sectionDetail/",{sectionid:e.sectionList.sectionid}).then(function(o){e.sectionDetail=o.data.sectiondetail,t.postRequest("getSectionList/",{courseid:e.sectionDetail.courseid}).then(function(t){e.sectionList=t.data.course})}),e.currentIndex=s,e.prevdisable=!1})},e.getPreviousIndex=function(){t.postRequest("getSectionList/",{courseid:e.sectionDetail.courseid}).then(function(o){e.sectionList=o.data.course;var s=e.currentIndex-1;e.sectionno=s+1,0===s&&(e.prevdisable=!0),e.sectionList=o.data.course[s],t.postRequest("user/sectionDetail/",{sectionid:e.sectionList.sectionid}).then(function(o){e.sectionDetail=o.data.sectiondetail,t.postRequest("getSectionList/",{courseid:e.sectionDetail.courseid}).then(function(t){e.sectionList=t.data.course})}),e.currentIndex=s,e.nextdisable=!1})},e.courseinit=function(){e.courselist()},e.mycourseinit=function(){e.mycourselist()},e.categorycourseinit=function(){e.paginationLoad=!1,e.categoryCourseList()},e.viewinit=function(){e.courseDetails(),e.courseSectionList()},$(".show-list-search").click(function(){$(".search-list-form").toggle(300),$(".search-list-form input").focus()})}]),userApp.filter("trusted",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),userApp.filter("html",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),userApp.filter("startsWithLetterCourse",function(){return function(e,t){var o=[],s=new RegExp(t,"i");if(e)for(var i=0;i<e.length;i++){var n=e[i];(s.test(n.ownername)||s.test(n.coursename))&&o.push(n)}else;return o}});var adminApp=angular.module("adminApp",["ngRoute","oc.lazyLoad","ngCookies","requestModule","flash","angularUtils.directives.dirPagination"]);adminApp.controller("CourseAdminController",["$scope","requestHandler","Flash","$routeParams","$location",function(e,t,o,s,i){e.courselist=function(){t.postRequest("getPublishedCourse/",{offset:0,limit:10}).then(function(t){e.courseList=t.data.published_Course,e.paginationLoad=!0},function(){errorMessage(o,"Please try again later!")})},e.courseDetails=function(){t.postRequest("courseDetail/",{courseid:s.id}).then(function(t){e.courseDetails=t.data.coursedetail,e.courseDetails.role="admin"},function(){errorMessage(o,"Please try again later!")})},e.courseSectionList=function(){t.postRequest("getSectionList/",{courseid:s.id}).then(function(t){e.sectionList=t.data.course},function(){errorMessage(o,"Please try again later!")})},e.courseSectionDetails=function(){t.postRequest("admin/getSectionDetail/",{sectionid:s.id}).then(function(o){e.sectionDetail=o.data["Section Detail"],e.sectionno=1,t.postRequest("getSectionList/",{courseid:e.sectionDetail.courseid}).then(function(t){e.sectionList=t.data.course,e.sectionLength=e.sectionList.length,$.each(e.sectionList,function(t,o){o.sectionid==s.id&&(e.currentIndex=t,e.sectionno=t+1),1===e.sectionList.length&&(e.nextdisable=!0)})})},function(){errorMessage(o,"Please try again later!")})},e.courseSectionDetailsbyId=function(s){t.postRequest("admin/getSectionDetail/",{sectionid:s}).then(function(t){e.sectionDetail=t.data["Section Detail"],$.each(e.sectionList,function(t,o){o.sectionid==s&&(e.currentIndex=t,e.sectionno=t+1)})},function(){errorMessage(o,"Please try again later!")})};var n=0;e.nextdisable=!1,e.prevdisable=!0,e.getNextIndex=function(){t.postRequest("getSectionList/",{courseid:e.sectionDetail.courseid}).then(function(o){e.sectionList=o.data.course;var s=n+1;e.sectionno=s+1,s===e.sectionList.length-1&&(e.nextdisable=!0),e.sectionList=o.data.course[s],t.postRequest("admin/getSectionDetail/",{sectionid:e.sectionList.sectionid}).then(function(o){e.sectionDetail=o.data["Section Detail"],t.postRequest("getSectionList/",{courseid:e.sectionDetail.courseid}).then(function(t){e.sectionList=t.data.course})}),n=s,e.prevdisable=!1})},e.getPreviousIndex=function(){t.postRequest("getSectionList/",{courseid:e.sectionDetail.courseid}).then(function(o){e.sectionList=o.data.course;var s=n-1;e.sectionno=s+1,0===s&&(e.prevdisable=!0),e.sectionList=o.data.course[s],t.postRequest("admin/getSectionDetail/",{sectionid:e.sectionList.sectionid}).then(function(o){e.sectionDetail=o.data["Section Detail"],t.postRequest("getSectionList/",{courseid:e.sectionDetail.courseid}).then(function(t){e.sectionList=t.data.course})}),n=s,e.nextdisable=!1})},e.pendingcourselist=function(){t.getRequest("admin/listOfPendingCourses/","").then(function(t){e.pendingCourseList=t.data.pendingcourses,e.pendingCount=[e.pendingCourseList.length],console.log(e.pendingCount),e.page="pending",e.paginationLoad=!0},function(){errorMessage(o,"Please try again later!")})},e.doAcceptCourse=function(s){t.postRequest("admin/publishCourse/",{courseid:s}).then(function(){e.pendingcourselist(),i.path("coursePending"),successMessage(o,"Successfully Published")},function(){errorMessage(o,"Please try again later!")})},e.doRejectCourse=function(s){t.postRequest("admin/rejectCourse/",{courseid:s,comments:e.comments}).then(function(){e.pendingcourselist(),i.path("coursePending"),successMessage(o,"Successfully Rejected")},function(){errorMessage(o,"Please try again later!")})},e.viewinit=function(){e.courseDetails(),e.courseSectionList()},e.publishedCourses=function(){e.courselist(),e.pendingcourselist()},e.resetrejectdata=function(){e.comments={},e.comments="",e.courseRejectForm.$setPristine()},e.publishedCourses(),$(".show-list-search").click(function(){$(".search-list-form").toggle(300),$(".search-list-form input").focus()}),e.modal=function(t){e.courseid=t,$("html, body").animate({scrollTop:0},600),$(function(){$("#lean_overlay").fadeTo(1e3),$(".modalRejectCourse").fadeIn(600),$(".common_model").show()}),$(".modal_close").click(function(){$(".common_model").hide(),$(".modalRejectCourse").hide(),$("#lean_overlay").hide(),e.resetrejectdata()}),$("#lean_overlay").click(function(){$(".common_model").hide(),$(".modalRejectCourse").hide(),$("#lean_overlay").hide(),e.resetrejectdata()})},e.acceptModal=function(t){e.courseid=t,$("html, body").animate({scrollTop:0},600),$(function(){$("#lean_overlay").fadeTo(1e3),$("#modal").fadeIn(600),$(".common_model").show()}),$(".modal_close").click(function(){$(".common_model").hide(),$("#modal").hide(),$("#lean_overlay").hide()}),$("#lean_overlay").click(function(){$(".common_model").hide(),$("#modal").hide(),$("#lean_overlay").hide()})}}]),adminApp.filter("trusted",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),adminApp.filter("html",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),adminApp.filter("startsWithLetterCourse",function(){return function(e,t){var o=[],s=new RegExp(t,"i");if(e)for(var i=0;i<e.length;i++){var n=e[i];(s.test(n.coursename)||s.test(n.coursesubtitle)||s.test(n.categoryname)||s.test(n.ownername)||s.test(n.price)||s.test(n.enrollcount)||s.test(n.createdon)||s.test(n.publishedon))&&o.push(n)}else;return o}}),adminApp.filter("startsWithLetterPending",function(){return function(e,t){var o=[],s=new RegExp(t,"i");if(e)for(var i=0;i<e.length;i++){var n=e[i];(s.test(n.coursename)||s.test(n.coursesubtitle)||s.test(n.categoryname)||s.test(n.ownername)||s.test(n.price)||s.test(n.createdon)||s.test(n.reviewdate))&&o.push(n)}else;return o}});var coachApp=angular.module("coachApp",["ngRoute","oc.lazyLoad","ngCookies","requestModule","flash","summernote"]);coachApp.controller("CourseController",["$scope","requestHandler","Flash","$routeParams","$location",function(e,t,o,s,i){s.id?(e.loaded=!0,e.getCourseDetails=function(){t.postRequest("coach/getCourseDetail/",{courseid:s.id}).then(function(t){e.courseDetails=t.data["Course details"],e.courseDetails.promoimage=e.courseDetails.promoimage+"?decache="+Math.random(),e.getAllSections(e.courseDetails.courseid)},function(){errorMessage(o,"Please try again later!")})},e.getAllSections=function(s){t.postRequest("coach/getCourseSections/",{courseid:s}).then(function(t){e.courseSections=t.data.CourseSections.sections,e.loaded=!1},function(){errorMessage(o,"Please try again later!")})},e.getCourseDetails(),0!=e.courseSections&&RowSorter("table[attr-sample=thetable]",{handler:"td.sorter",stickFirstRow:!0,stickLastRow:!1,onDragStart:function(e,t,o){log("start index is "+o)},onDrop:function(i,n,c,a){e.loaded=!0,e.sortSectionIdlist=[],e.sortSectionIdUnlist=[];var r=a+1,u=c+1;u>r?$.each(e.courseSections,function(t,o){o.sequenceno<r?e.sortSectionIdlist.push(o.sectionid):r<=o.sequenceno&&o.sequenceno<u?e.sortSectionIdlist.push(e.courseSections[t+1].sectionid):o.sequenceno==u?e.sortSectionIdlist.push(e.courseSections[r-1].sectionid):e.sortSectionIdlist.push(o.sectionid)}):$.each(e.courseSections,function(t,o){e.sortSectionIdUnlist.push(o.sectionid),o.sequenceno<u?e.sortSectionIdlist.push(o.sectionid):u<o.sequenceno&&o.sequenceno<=r?e.sortSectionIdlist.push(e.courseSections[t-1].sectionid):o.sequenceno==u?e.sortSectionIdlist.push(e.courseSections[r-1].sectionid):e.sortSectionIdlist.push(o.sectionid)}),t.postRequest("coach/swapCourseSection/",{sectionidList:e.sortSectionIdlist,courseid:s.id}).then(function(){successMessage(o,"Sections Sorted Successfully!"),e.getAllSections(s.id)},function(){errorMessage(o,"Please try again later!")})}})):s.sectionId||t.getRequest("coach/getCourseList/","").then(function(t){e.courselength=t.data.course,0===e.courselength.length?e.myCourseList="":e.myCourseList=t.data.course.course_list,$.each(e.myCourseList,function(e,t){t.promoimage=t.promoimage+"?decache="+Math.random()}),e.loaded=!1},function(){errorMessage(o,"Please try again later!")}),s.sectionId&&t.postRequest("coach/detailCourseSection/",{sectionid:s.sectionId}).then(function(o){e.sectionDetails=o.data.CourseSectionDetail,t.postRequest("coach/getCourseSections/",{courseid:e.sectionDetails.courseid}).then(function(t){e.courseSections=t.data.CourseSections.sections,e.sectionLength=e.courseSections.length})},function(){errorMessage(o,"Please try again later!")}),e.changeSection=function(o){t.postRequest("coach/detailCourseSection/",{sectionid:o}).then(function(t){e.sectionDetails=t.data.CourseSectionDetail}),$("body").animate({scrollTop:0},600)},e.nextSection=function(t){$.each(e.courseSections,function(o,s){s.sequenceno==t+1&&e.changeSection(s.sectionid)})},e.prevSection=function(t){$.each(e.courseSections,function(o,s){s.sequenceno==t-1&&e.changeSection(s.sectionid)})},e.doDeleteCourse=function(){t.postRequest("coach/deleteCourse/",{courseid:s.id}).then(function(){i.path("course")},function(){errorMessage(o,"Please try again later!")})},e.sendCourseToReview=function(n){t.postRequest("coach/sendCourseForReview/",{courseid:n}).then(function(){successMessage(o,"Course Sent for Review!"),s.id?e.getCourseDetails():i.path("courseView/"+n)},function(){errorMessage(o,"Please try again later!")})},e.deleteSection=function(n){t.deleteRequest("coach/deleteCourseSection/",{sectionid:e.deleteSectionId}).then(function(){s.sectionId==e.deleteSectionId?i.path("courseView/"+n):s.sectionId!=e.deleteSectionId&&e.getCourseDetails(),successMessage(o,"Section Deleted Successfully!")},function(){errorMessage(o,"Please try again later!")})},e.reviewModel=function(){t.getRequest("getUserId/","").then(function(t){e.response=t.data.Login.status,$(function(){$("#lean_overlay").fadeTo(1e3),$("#review-modal").fadeIn(600),$(".common_model").show()}),$(".modal_close").click(function(){$(".common_model").hide(),$("#review-modal").hide(),$("#lean_overlay").hide()}),$("#lean_overlay").click(function(){$(".common_model").hide(),$("#review-modal").hide(),$("#lean_overlay").hide()})})},e.sectionDeleteModel=function(t){$("html, body").animate({scrollTop:0},600),e.deleteSectionId=t,$(function(){$("#lean_overlay").fadeTo(1e3),$("#section-modal").fadeIn(600),$(".common_model").show()}),$(".modal_close").click(function(){$(".common_model").hide(),$("#section-modal").hide(),$("#lean_overlay").hide()}),$("#lean_overlay").click(function(){$(".common_model").hide(),$("#section-modal").hide(),$("#lean_overlay").hide()})},e.deleteModel=function(){$(function(){$("#lean_overlay").fadeTo(1e3),$("#modal").fadeIn(600),$(".common_model").show()}),$(".modal_close").click(function(){$(".common_model").hide(),$("#modal").hide(),$("#lean_overlay").hide()}),$("#lean_overlay").click(function(){$(".common_model").hide(),$("#modal").hide(),$("#lean_overlay").hide()})}}]),coachApp.controller("CourseEditController",["$scope","requestHandler","Flash","$routeParams","$location",function(e,t,o,s,i){e.courseDetails={};e.isCancel=s.cancelvalue,s.courseId&&(e.SectionTitle="Add Section",e.sectionDetails={},e.isAdd=1,e.sectionDetails.courseid=parseInt(s.courseId),e.options={height:300},e.addSection=function(){e.loaded=!0,t.postRequest("coach/insertCourseSection/",e.sectionDetails).then(function(t){i.path("courseSection/"+t.data.CourseSection.sectionid),e.loaded=!1,successMessage(o,"Section Successfully Added!")},function(){errorMessage(o,"Please try again later!")})}),s.id?(e.isAdd=0,e.CourseTitle="Edit Course",e.options={height:200,airMode:!0,toolbar:[["font",["bold","italic","underline","clear"]],["para",["ul","ol","paragraph"]]]},t.postRequest("coach/getCourseDetail/",{courseid:s.id}).then(function(t){e.courseDetails=t.data["Course details"],e.courseDetails.promoimage=e.courseDetails.promoimage+"?decache="+Math.random(),e.originalCourseDetails=angular.copy(e.courseDetails),console.log(angular.equals(e.originalCourseDetails,e.courseDetails)),$(".image-editor").cropit({imageState:{src:e.courseDetails.promoimage+"?decache="+Math.random()}})},function(){errorMessage(o,"Please try again later!")}),t.getRequest("getCoursecategory/","").then(function(t){e.options=t.data.coursecategory},function(){errorMessage(o,"Please try again later!")})):s.courseId||s.sectionId||(e.isAdd=1,e.CourseTitle="Add Course",e.options={height:300},e.courseDetails.categoryid=1,e.courseDetails.promoimage="../../images/no-course.jpg",$(".image-editor").cropit({imageState:{src:"../../images/no-course.jpg"}}),t.getRequest("getCoursecategory/","").then(function(t){e.options=t.data.coursecategory},function(){errorMessage(o,"Please try again later!")})),e.isCleanCourse=function(){return console.log("ori",e.originalCourseDetails),console.log("adssd",e.courseDetails),console.log(angular.equals(e.originalCourseDetails,e.courseDetails)),angular.equals(e.originalCourseDetails,e.courseDetails)},e.doUpdateImage=function(){if(0==e.isAdd){var s={};s.coursename=e.originalCourseDetails.coursename,s.coursesubtitle=e.originalCourseDetails.coursesubtitle,s.coursedescription=e.originalCourseDetails.coursedescription,s.price=e.originalCourseDetails.price,s.categoryid=e.originalCourseDetails.categoryid,s.courseid=e.originalCourseDetails.courseid,s.promoimage=$(".image-editor").cropit("export"),t.putRequest("coach/updateCourse/",s).then(function(t){e.imageUpdatedDetails=t.data.Course,e.courseDetails.promoimage=e.imageUpdatedDetails.promoimage+"?decache="+Math.random(),$(".image-editor").cropit({imageState:{src:e.courseDetails.promoimage+"?decache="+Math.random()}})},function(){errorMessage(o,"Please try again later!")})}else e.courseDetails.promoimage=$(".image-editor").cropit("export")},e.doAddCourse=function(){"../../images/no-course.jpg"===e.courseDetails.promoimage?e.convertImgToBase64(e.courseDetails.promoimage,function(s){e.courseDetails.promoimage=s,t.postRequest("coach/insertCourse/",e.courseDetails).then(function(e){i.path("courseView/"+e.data.Course.courseid)},function(){errorMessage(o,"Please try again later!")})}):t.postRequest("coach/insertCourse/",e.courseDetails).then(function(e){i.path("courseView/"+e.data.Course.courseid)},function(){errorMessage(o,"Please try again later!")})},e.convertImgToBase64=function(e,t,o){var s=new Image;s.crossOrigin="Anonymous",s.onload=function(){var e=document.createElement("CANVAS"),s=e.getContext("2d");e.height=this.height,e.width=this.width,s.drawImage(this,0,0);var i=e.toDataURL(o||"image/jpg");t(i),e=null},s.src=e},e.doUpdateCourse=function(){var s={};s.coursename=e.courseDetails.coursename,s.coursesubtitle=e.courseDetails.coursesubtitle,s.coursedescription=e.courseDetails.coursedescription,s.price=e.courseDetails.price,s.categoryid=e.courseDetails.categoryid,s.courseid=e.courseDetails.courseid,t.putRequest("coach/updateCourse/",s).then(function(e){i.path("courseView/"+e.data.Course.courseid),successMessage(o,"Course Updated Successfully!")},function(){errorMessage(o,"Please try again later!")})},s.sectionId&&(e.loaded=!0,e.SectionTitle="Edit Section",e.isAdd=0,e.options={height:300},t.postRequest("coach/detailCourseSection/",{sectionid:s.sectionId}).then(function(t){e.sectionDetails=t.data.CourseSectionDetail,e.originalSectionDetails=angular.copy(e.sectionDetails),e.loaded=!1},function(){errorMessage(o,"Please try again later!")})),e.isClean=function(){return angular.equals(e.originalSectionDetails,e.sectionDetails)},e.doUpdateSection=function(){e.loaded=!0;var s={};s.sectionid=e.sectionDetails.sectionid,s.sectiontitle=e.sectionDetails.sectiontitle,s.sectioncontent=e.sectionDetails.sectioncontent,t.putRequest("coach/updateCourseSection/",s).then(function(t){i.path("courseSection/"+t.data.CourseSection.sectionid),e.loaded=!1,successMessage(o,"Section Updated Successfully!")},function(){errorMessage(o,"Please try again later!")})},e.openCourseImageModel=function(){$(function(){$("#lean_overlay").fadeTo(1e3),$("#modal").fadeIn(600),$(".common_model").show()}),$(".modal_close").click(function(){$(".common_model").hide(),$("#modal").hide(),$("#lean_overlay").hide()}),$("#lean_overlay").click(function(){$(".common_model").hide(),$("#modal").hide(),$("#lean_overlay").hide()})}}]),coachApp.filter("trusted",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),coachApp.filter("html",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]);