var userApp=angular.module("userApp",["ngRoute","oc.lazyLoad","ngCookies","requestModule","flash","ngAnimate","angularUtils.directives.dirPagination"]);userApp.controller("GoalController",["$scope","requestHandler","Flash","$route","$routeParams","$location",function(a,b,c,d,e,f){a.activeClass.groupGoal="active",a.doGetMyGoalList=function(){a.paginationLoad=!1,a.loaded=!0,b.getRequest("user/getMyGoallist","").then(function(c){a.myGoalList=[],a.myRequestGoalList=[],$.each(c.data.MyGoallist,function(c,d){b.postRequest("user/getGoalMemberList/",{goalid:d.goalid}).then(function(b){d.members=b.data.Goal_Data.length,1==d.activestatus?a.myGoalList.push(d):a.myRequestGoalList.push(d)})}),a.loaded=!1,a.paginationLoad=!0})},a.doGetViewGoal=function(){a.isRequest=d.current.request,b.postRequest("user/getIndividualGoalDetail/",{goalid:e.id}).then(function(b){a.goalDetail=b.data.Goal_Data,2==a.goalDetail.status&&a.viewRank()})},a.doGetViewGoalMember=function(){a.loaded=!0,a.memberUserIdList=[],b.postRequest("user/getGoalMemberList/",{goalid:e.id}).then(function(c){a.goalMembers=c.data.Goal_Data,$.each(a.goalMembers,function(b,c){a.memberUserIdList.push(c.userid)}),a.loaded=!1,b.getRequest("user/getMyFriendsList/","").then(function(b){a.myRemainderFriendsList=[],$.each(b.data.Friends_List,function(b,c){"-1"==a.memberUserIdList.indexOf(c.userid)&&a.myRemainderFriendsList.push(c)})})})},a.doAddMember=function(c){b.postRequest("user/insertGoalMembers/",{goalid:e.id,memberlist:[c]}).then(function(){a.doGetViewGoalMember()})},a.doRemoveMember=function(d){b.deleteRequest("user/deleteGoalMember/",{goalid:e.id,memberid:d}).then(function(){successMessage(c,"Successfully Removed!"),a.doGetViewGoalMember()},function(){errorMessage(c,"Please try again later!")})},a.doConfirmation=function(b){$(function(){$("#lean_overlay").fadeTo(1e3),$("#confirmation").fadeIn(600),$(".common_model").show()}),a.deleteId=b,$(".modal_close").click(function(){$(".common_model").hide(),$("#confirmation").hide(),$("#lean_overlay").hide()}),$("#lean_overlay").click(function(){$(".common_model").hide(),$("#confirmation").hide(),$("#lean_overlay").hide()})},a.doDeleteGroup=function(d){b.deleteRequest("user/deleteGoal/",{goalid:d}).then(function(b){successMessage(c,"Goal Successfully Deleted!"),a.doGetMyGoalList()},function(){errorMessage(c,"Please try again later!")})},a.doQuitGroup=function(){b.postRequest("user/completeGoal/",{goalid:e.id}).then(function(b){successMessage(c,"Goal Successfully Completed!"),a.doGetViewGoal()},function(){errorMessage(c,"Please try again later!")})},a.doExitConfirmation=function(){$(function(){$("#lean_overlay").fadeTo(1e3),$("#confirmation-remove").fadeIn(600),$(".common_model").show()}),$(".modal_close").click(function(){$(".common_model").hide(),$("#confirmation-remove").hide(),$("#lean_overlay").hide()}),$("#lean_overlay").click(function(){$(".common_model").hide(),$("#confirmation-remove").hide(),$("#lean_overlay").hide()})},a.doExitGroup=function(){b.deleteRequest("user/rejectOrExistGoalMember/",{goalid:e.id}).then(function(b){a.isRequest?f.path("/groupGoalRequest"):f.path("/groupGoal"),successMessage(c,"Successfully Exit!"),a.doGetMyGoalList()},function(){errorMessage(c,"Please try again later!")})},a.doAcceptGroup=function(){b.putRequest("user/acceptGoal/",{goalid:e.id}).then(function(a){successMessage(c,"Successfully Accepted!"),f.path("/groupGoalView/"+e.id)},function(){errorMessage(c,"Please try again later!")})},a.doAddGoalPopup=function(){a.createGoal={},a.createGoalForm.$setPristine(),a.createGoal.goaltype=1,$(function(){$("#lean_overlay").fadeTo(1e3),$("#createGoal").fadeIn(600),$(".common_model").show(),a.shouldBeOpen=!0}),$(".modal_close").click(function(){$(".common_model").hide(),$("#createGoal").hide(),$("#lean_overlay").hide(),a.shouldBeOpen=!1}),$("#lean_overlay").click(function(){$(".common_model").hide(),$("#createGoal").hide(),$("#lean_overlay").hide(),a.shouldBeOpen=!1})},a.viewRank=function(){b.postRequest("user/rankGoalList/",{goalid:e.id}).then(function(b){a.rankList=b.data.Goal_Data,1==a.goalDetail.status&&($(function(){$("#lean_overlay").fadeTo(1e3),$("#modal1").fadeIn(600),$(".common_model").show()}),$(".modal_close").click(function(){$(".common_model").hide(),$("#modal1").hide(),$("#lean_overlay").hide()}),$("#lean_overlay").click(function(){$(".common_model").hide(),$("#modal1").hide(),$("#lean_overlay").hide()}))},function(){errorMessage(c,"Please try again later!")})},e.id?(a.doGetViewGoal(),a.doGetViewGoalMember()):a.doGetMyGoalList();var g=new Date,h=g.getDate(),i=g.getMonth()+1,j=g.getFullYear();10>h&&(h="0"+h),10>i&&(i="0"+i),g=h+"/"+i+"/"+j,a.doCreateGoal=function(){a.loaded=!0,""==document.getElementById("start").value?a.createGoal.startdate=a.createGoal.enddate=g:(a.createGoal.startdate=document.getElementById("start").value,a.createGoal.enddate=document.getElementById("end").value),a.createGoal.goaltype=parseInt(a.createGoal.goaltype),b.postRequest("user/insertUserGoal/",a.createGoal).then(function(b){successMessage(c,"Goal Successfully Created!"),a.doGetMyGoalList(),a.loaded=!1},function(){errorMessage(c,"Please try again later!")})},a.doAcceptGoalRequest=function(a){b.putRequest("user/acceptGoal/",{goalid:a}).then(function(){successMessage(c,"Successfully Joined!"),$("#modal_trigger1").leanModal({top:200,overlay:.6,closeButton:".modal_close"}),f.path("/groupGoalView/"+a)},function(){errorMessage(c,"Please try again later!")})},a.doDeleteGoalRequest=function(d){b.deleteRequest("user/rejectOrExistGoalMember/",{goalid:d}).then(function(){successMessage(c,"Successfully Exited!"),a.doGetMyGoalList()},function(){errorMessage(c,"Please try again later!")})},a.resetdata=function(){a.friendsearch="",$(function(){$("#lean_overlay").fadeTo(1e3),$("#modal").fadeIn(600),$(".common_model").show()}),$(".modal_close").click(function(){$(".common_model").hide(),$("#modal").hide(),$("#lean_overlay").hide()}),$("#lean_overlay").click(function(){$(".common_model").hide(),$("#modal").hide(),$("#lean_overlay").hide()})}}]),userApp.controller("GoalViewController",function(){}),userApp.filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),userApp.filter("startsWithLetter",function(){return function(a,b){var c=[],d=new RegExp(b,"i");if(a)for(var e=0;e<a.length;e++){var f=a[e];d.test(f.user_name)&&c.push(f)}else;return c}}),userApp.filter("startsWithLetterRemain",function(){return function(a,b){var c=[],d=new RegExp(b,"i");if(a)for(var e=0;e<a.length;e++){var f=a[e];d.test(f.name)&&c.push(f)}else;return c}});