var userApp=angular.module("userApp",["ngRoute","oc.lazyLoad","requestModule","flash","ngAnimate","angularUtils.directives.dirPagination"]);userApp.controller("UserCoachController",function(e,a,t,i,s,c){e.activeClass.coach="active",e.coachreview={ratinglevel:1},e.averageRate=.1,e.paginationLoad=!1;var n=[];$(".show-list-search").click(function(){$(".search-list-form").toggle(300),$(".search-list-form input").focus()}),e.doGetCoachListByUser=function(){a.getRequest("user/getallCoachListbyUser/","").then(function(a){e.usercoachlist1=a.data.getallCoachListbyUser,c.renew?e.doGetCoachDetailsByUser(c.renew):e.usercoachlist1.length>0&&e.doGetCoachDetailsByUser(a.data.getallCoachListbyUser[0].userid);var t;$.each(e.usercoachlist1,function(a,i){i.averageRating=.1,t=e.doGetRatingsByCoach(i.userid),t.then(function(e){0!=e.averageRatings&&(i.averageRating=e.averageRatings),i.totalReviews=e.totalRatings})}),s.all([t]).then(function(){e.usercoachlist=e.usercoachlist1,0==e.usercoachlist||(e.coach={status:"coach-view"})})},function(){errorMessage(t,"Please try again later!")})},e.doGetRatingsByCoach=function(e){return a.getRequest("getRatingsandReviews/"+e,"").then(function(e){return e.data.Ratings_Reviews})},e.doGetCoachRatings=function(t){e.reviewload=!0,a.getRequest("getRatingsandReviews/"+t,"").then(function(a){e.coachReviews=a.data.Ratings_Reviews.Reviews,e.reviewload=!1})},e.doGetCoachDetailsByUser=function(i){e.coach={status:"coach-view"},e.doGetMyCoachListByUser(),-1!=n.indexOf(i)?e.checkSubscribed=0:e.checkSubscribed=1,e.viewload=!0,a.getRequest("getCoachIndividualDetailbyUser/"+i,"").then(function(a){e.usercoachdetails=a.data.getCoachIndividualDetail,null==e.usercoachdetails.about&&(e.usercoachdetails.about="NA"),null==e.usercoachdetails.specialist&&(e.usercoachdetails.specialist="NA"),null==e.usercoachdetails.qualification&&(e.usercoachdetails.qualification="NA"),null==e.usercoachdetails.experience&&(e.usercoachdetails.experience="0"),null==e.usercoachdetails.specialist&&(e.usercoachdetails.specialist="NA"),null==e.usercoachdetails.phone&&(e.usercoachdetails.phone="NA"),null==e.usercoachdetails.dob&&(e.usercoachdetails.dob="NA"),null==e.usercoachdetails.country&&(e.usercoachdetails.country="NA"),null==e.usercoachdetails.state&&(e.usercoachdetails.state="NA"),null==e.usercoachdetails.city&&(e.usercoachdetails.city="NA"),null==e.usercoachdetails.zipcode&&(e.usercoachdetails.zipcode="NA")}),a.getRequest("getRatingsandReviews/"+i,"").then(function(a){e.coachReviews=a.data.Ratings_Reviews,e.viewload=!1,e.totalRatings=e.coachReviews.totalRatings,e.avgRatings=e.coachReviews.averageRatings,0==e.coachReviews.averageRatings?e.averageRate=.1:e.averageRate=e.coachReviews.averageRatings},function(){},function(){errorMessage(t,"Please try again later!")})},e.doGetMyCoachListByUser=function(){e.loaded=!0,a.getRequest("user/getmyCoachList/","").then(function(a){e.mycoachlist=a.data.getmyCoachList,e.loaded=!1,$.each(e.mycoachlist,function(e,a){n.push(a.userid)}),e.paginationLoad=!0},function(){errorMessage(t,"Please try again later!")})},e.subscribeButtonStatus=!1,e.subscribing=[],e.doSubscribeCoach=function(i,s){e.subscribeButtonStatus=!0,e.subscribing[s]=!0,a.postRequest("user/subscribeCoach/",{coachid:i,month:s,returnUrl:a.paymentURL()+"/#/thanksSubscribePage/"+i+"/"+s,cancelUrl:a.paymentURL()+"/#/coachSearch"}).then(function(e){1==e.data.transactionStatus?window.location=e.data.approveURL.href:2==e.data.transactionStatus&&(window.location=a.paymentURL()+"/#/thanksSubscribePage/"+i+"/"+s)},function(){errorMessage(t,"Please try again later!")})},e.coachListInit=function(){e.doGetMyCoachListByUser()},e.userCoachInit=function(){e.doGetCoachListByUser(),e.coach={status:"coach-view"}},e.userCoachViewInit=function(){e.disablereview=!0,e.checkReview(),e.doGetCoachDetailsByUser(c.id),e.coachView={status:"coach-reviews"},e.doGetCoachRatings(c.id),e.subscribed=1},e.coachReview=function(a){e.doGetCoachRatings(a),e.subscribed=0,e.coachViewId=a,e.coach={status:"coach-reviews"}},e.priceTable=function(i){e.coachViewId=i,e.coach={status:"coach-price"},a.getRequest("getCoachIndividualDetailbyUser/"+i,"").then(function(a){e.priceValue=a.data.getCoachIndividualDetail.subscriptionDetail},function(){errorMessage(t,"Please try again later!")})},e.coachView=function(a){e.doGetCoachDetailsByUser(a)},e.doAddReview=function(){e.coachreview.review_coach=c.id,a.postRequest("user/insertRatingsandReviews/",e.coachreview).then(function(){successMessage(t,"Successfully Added"),e.userCoachViewInit()},function(){errorMessage(t,"Please try again later!")})},e.reset=function(){e.coachreview.reviewtitle="",e.coachreview.reviewdescription="",e.reviewForm.$setPristine()},e.checkReview=function(){e.checkReviews="",a.getRequest("getUserId/","").then(function(t){e.userProfile=t.data.User_Profile,e.loginuserid=e.userProfile.userid,a.getRequest("getRatingsandReviews/"+c.id,"").then(function(a){e.checkReviews=a.data.Ratings_Reviews.Reviews,userTypeArray=[],$.each(e.checkReviews,function(e,a){userTypeArray.push(a.review_user)}),e.check=userTypeArray,-1!=e.check.indexOf(e.loginuserid)?e.disablereview=!0:e.disablereview=!1})})}}),userApp.filter("trusted",["$sce",function(e){return function(a){return e.trustAsResourceUrl(a)}}]),userApp.directive("starRating",function(){return{restrict:"EA",template:"<ul class='rating' ng-class='{readonly: readonly}'>  <li ng-repeat='star in stars' ng-class='star' ng-click='toggle($index)'>    <i class='fa fa-star'></i>  </li></ul>",scope:{ratingValue:"=ngModel",max:"=?",readonly:"=?"},link:function(e){function a(){e.stars=[];for(var a=0;a<e.max;a++)e.stars.push({filled:a<e.ratingValue.ratinglevel})}void 0==e.max&&(e.max=5),e.toggle=function(a){(void 0==e.readonly||0==e.readonly)&&(e.ratingValue.ratinglevel=a+1,e.onRatingSelected({ratinglevel:a+1}))},e.$watch("ratingValue.ratinglevel",function(e,t){t&&a()})}}}),userApp.directive("averageStarRating",function(){return{restrict:"EA",template:"<div class='average-rating-container'>  <ul class='rating background' class='readonly'>    <li ng-repeat='star in stars' class='star'>      <i class='fa fa-star'></i>    </li>  </ul>  <ul class='rating foreground' class='readonly' ng-attr-style='width:{{filledInStarsContainerWidth}}%'>    <li ng-repeat='star in stars' class='star filled'>      <i class='fa fa-star'></i>    </li>  </ul></div>",scope:{averageRatingValue:"=ngModel",max:"=?"},link:function(e){function a(){e.stars=[];for(var a=0;a<e.max;a++)e.stars.push({});var t=76;e.filledInStarsContainerWidth=e.averageRatingValue/e.max*t}void 0==e.max&&(e.max=5),e.$watch("averageRatingValue",function(e,t){t&&a()})}}}),userApp.filter("startsWithLetter",function(){return function(e,a){var t=[],i=new RegExp(a,"i");if(e)for(var s=0;s<e.length;s++){var c=e[s];(i.test(c.emailid)||i.test(c.name))&&t.push(c)}else;return t}}),userApp.filter("startsWithLetterSearch",function(){return function(e,a){var t=[],i=new RegExp(a,"i");if(e)for(var s=0;s<e.length;s++){var c=e[s];(i.test(c.emailid)||i.test(c.name))&&t.push(c)}else;return t}});