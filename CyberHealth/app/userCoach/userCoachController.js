var userApp=angular.module("userApp",["ngRoute","oc.lazyLoad","requestModule","flash","ngAnimate","angularUtils.directives.dirPagination","angular-nicescroll"]);userApp.controller("UserCoachController",["$scope","requestHandler","Flash","$location","$q","$routeParams",function(a,b,c,d,e,f){a.activeClass.coach="active",a.coachreview={ratinglevel:1},a.averageRate=.1,a.paginationLoad=!1;var g=[];$(".show-list-search").click(function(){$(".search-list-form").toggle(300),$(".search-list-form input").focus()}),a.doGetCoachListByUser=function(){b.getRequest("user/getallCoachListbyUser/","").then(function(b){a.usercoachlist1=b.data.getallCoachListbyUser,f.renew?a.doGetCoachDetailsByUser(f.renew):a.usercoachlist1.length>0&&a.doGetCoachDetailsByUser(b.data.getallCoachListbyUser[0].userid);var c;$.each(a.usercoachlist1,function(b,d){d.averageRating=.1,c=a.doGetRatingsByCoach(d.userid),c.then(function(a){0!=a.averageRatings&&(d.averageRating=a.averageRatings),d.totalReviews=a.totalRatings})}),e.all([c]).then(function(){a.usercoachlist=a.usercoachlist1,0==a.usercoachlist||(a.coach={status:"coach-view"})})},function(){errorMessage(c,"Please try again later!")})},a.doGetRatingsByCoach=function(a){return b.getRequest("getRatingsandReviews/"+a,"").then(function(a){return a.data.Ratings_Reviews})},a.doGetCoachRatings=function(c){a.reviewload=!0,a.coachReviews={},b.getRequest("getRatingsandReviews/"+c,"").then(function(b){a.coachReviews=b.data.Ratings_Reviews.Reviews,a.reviews=b.data.Ratings_Reviews,a.reviewload=!1,a.totalRatings=a.reviews.totalRatings,a.avgRatings=a.reviews.averageRatings,0==a.avgRatings?a.averageRate=.1:a.averageRate=a.reviews.averageRatings})},a.doGetCoachDetailsByUser=function(c){a.coach={status:"coach-view"},a.doGetMyCoachListByUser(),-1!=g.indexOf(c)?a.checkSubscribed=0:a.checkSubscribed=1,a.viewload=!0,b.getRequest("getCoachIndividualDetailbyUser/"+c,"").then(function(b){a.usercoachdetails=b.data.getCoachIndividualDetail,a.years=Math.trunc(a.usercoachdetails.experience/12),a.months=a.usercoachdetails.experience%12,null==a.usercoachdetails.about&&(a.usercoachdetails.about="NA"),null==a.usercoachdetails.specialist&&(a.usercoachdetails.specialist="NA"),null==a.usercoachdetails.qualification&&(a.usercoachdetails.qualification="NA"),null==a.usercoachdetails.experience&&(a.usercoachdetails.experience="0"),null==a.usercoachdetails.specialist&&(a.usercoachdetails.specialist="NA"),null==a.usercoachdetails.phone&&(a.usercoachdetails.phone="NA"),null==a.usercoachdetails.dob&&(a.usercoachdetails.dob="NA"),null==a.usercoachdetails.country&&(a.usercoachdetails.country="NA"),null==a.usercoachdetails.state&&(a.usercoachdetails.state="NA"),null==a.usercoachdetails.city&&(a.usercoachdetails.city="NA"),null==a.usercoachdetails.zipcode&&(a.usercoachdetails.zipcode="NA"),a.viewload=!1})},a.doGetMyCoachListByUser=function(){a.loaded=!0,b.getRequest("user/getmyCoachList/","").then(function(b){a.mycoachlist=b.data.getmyCoachList,a.loaded=!1,$.each(a.mycoachlist,function(a,b){g.push(b.userid)}),a.paginationLoad=!0},function(){errorMessage(c,"Please try again later!")})},a.subscribeButtonStatus=!1,a.subscribing=[],a.doSubscribeCoach=function(d,e){a.subscribeButtonStatus=!0,a.subscribing[e]=!0,b.postRequest("user/subscribeCoach/",{coachid:d,month:e,returnUrl:b.paymentURL()+"/#/thanksSubscribePage/"+d+"/"+e,cancelUrl:b.paymentURL()+"/#/coach-search"}).then(function(a){1==a.data.transactionStatus?window.location=a.data.approveURL:2==a.data.transactionStatus&&(window.location=b.paymentURL()+"/#/thanksSubscribePage/"+d+"/"+e)},function(){errorMessage(c,"Please try again later!")})},a.coachReview=function(b){a.doGetCoachRatings(b),a.subscribed=0,a.coachViewId=b,a.coach={status:"coach-reviews"}},a.priceTable=function(d){a.coachViewId=d,a.coach={status:"coach-price"},b.getRequest("getCoachIndividualDetailbyUser/"+d,"").then(function(b){a.priceValue=b.data.getCoachIndividualDetail.subscriptionDetail},function(){errorMessage(c,"Please try again later!")})},a.coachView=function(b){a.doGetCoachDetailsByUser(b)},a.doAddReview=function(){a.coachreview.review_coach=f.id,b.postRequest("user/insertRatingsandReviews/",a.coachreview).then(function(b){successMessage(c,"Successfully Added"),a.userCoachViewInit()},function(){errorMessage(c,"Please try again later!")})},a.reset=function(){a.coachreview.reviewtitle="",a.coachreview.reviewdescription="",a.reviewForm.$setPristine()},a.checkReview=function(){a.checkReviews="",b.getRequest("getUserId/","").then(function(c){a.userProfile=c.data.User_Profile,a.loginuserid=a.userProfile.userid,b.getRequest("getRatingsandReviews/"+f.id,"").then(function(b){a.checkReviews=b.data.Ratings_Reviews.Reviews,userTypeArray=[],$.each(a.checkReviews,function(a,b){userTypeArray.push(b.review_user)}),a.check=userTypeArray,-1!=a.check.indexOf(a.loginuserid)?a.disablereview=!0:a.disablereview=!1})})},a.userCoachViewInit=function(){a.disablereview=!0,a.checkReview(),a.doGetCoachDetailsByUser(f.id),a.coachView={status:"coach-reviews"},a.doGetCoachRatings(f.id),a.subscribed=1},a.coachListInit=function(){a.doGetMyCoachListByUser()},a.userCoachInit=function(){a.doGetCoachListByUser(),a.coach={status:"coach-view"}}}]),userApp.filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),userApp.directive("starRating",function(){return{restrict:"EA",template:"<ul class='rating' ng-class='{readonly: readonly}'>  <li ng-repeat='star in stars' ng-class='star' ng-click='toggle($index)'>    <i class='fa fa-star'></i>  </li></ul>",scope:{ratingValue:"=ngModel",max:"=?",readonly:"=?"},link:function(a,b,c){function d(){a.stars=[];for(var b=0;b<a.max;b++)a.stars.push({filled:b<a.ratingValue.ratinglevel})}void 0==a.max&&(a.max=5),a.toggle=function(b){void 0!=a.readonly&&0!=a.readonly||(a.ratingValue.ratinglevel=b+1,a.onRatingSelected({ratinglevel:b+1}))},a.$watch("ratingValue.ratinglevel",function(a,b){b&&d()})}}}),userApp.directive("averageStarRating",function(){return{restrict:"EA",template:"<div class='average-rating-container'>  <ul class='rating background' class='readonly'>    <li ng-repeat='star in stars' class='star'>      <i class='fa fa-star'></i>    </li>  </ul>  <ul class='rating foreground' class='readonly' ng-attr-style='width:{{filledInStarsContainerWidth}}%'>    <li ng-repeat='star in stars' class='star filled'>      <i class='fa fa-star'></i>    </li>  </ul></div>",scope:{averageRatingValue:"=ngModel",max:"=?"},link:function(a,b,c){function d(){a.stars=[];for(var b=0;b<a.max;b++)a.stars.push({});var c=76;a.filledInStarsContainerWidth=a.averageRatingValue/a.max*c}void 0==a.max&&(a.max=5),a.$watch("averageRatingValue",function(a,b){b&&d()})}}}),userApp.filter("startsWithLetter",function(){return function(a,b){var c=[],d=new RegExp(b,"i");if(a)for(var e=0;e<a.length;e++){var f=a[e];(d.test(f.emailid)||d.test(f.name))&&c.push(f)}else;return c}}),userApp.filter("startsWithLetterSearch",function(){return function(a,b){var c=[],d=new RegExp(b,"i");if(a)for(var e=0;e<a.length;e++){var f=a[e];(d.test(f.emailid)||d.test(f.name))&&c.push(f)}else;return c}});