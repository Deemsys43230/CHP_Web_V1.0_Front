var adminApp=angular.module("adminApp",["ngRoute","oc.lazyLoad","requestModule","flash","ngAnimate","ui.select","exerciseServiceModule"]);adminApp.filter("propsFilter",function(){return function(e,i){var t=[];return angular.isArray(e)?e.forEach(function(e){for(var a=!1,s=Object.keys(i),n=0;n<s.length;n++){var r=s[n],c=i[r].toLowerCase();if(-1!==e[r].toString().toLowerCase().indexOf(c)){a=!0;break}}a&&t.push(e)}):t=e,t}}),adminApp.controller("ExerciseController",["$scope","requestHandler","Flash",function(e,i,t){e.activeClass={exerciselist:"active"},e.doGetAllExercise=function(){e.loaded=!0,i.getRequest("admin/listofExercise/","").then(function(i){e.exerciseList=i.data.listexercises,e.paginationLoad=!0,e.loaded=!1},function(){})},e.doEnableDisable=function(a){e.loaded=!0,i.postRequest("admin/enableordisableExercise/",{exerciseid:a}).then(function(i){1==i.data.Response_status?successMessage(t,"Successfully Updated"):0==i.data.Response_status&&errorMessage(t,"Exercise used by users"),e.doGetAllExercise(),e.loaded=!1},function(){errorMessage(t,"Please Try Again Later")})},e.init=function(){e.paginationLoad=!1,e.doGetAllExercise()},e.init()}]),adminApp.controller("ExerciseViewController",["$scope","requestHandler","Flash","$routeParams",function(e,i,t,a){e.activeClass={exerciselist:"active"},e.doGetExerciseByID=function(){e.loaded=!0,i.postRequest("admin/getExerciseDetailByadmin/",{exerciseid:a.id}).then(function(t){e.exerciseDetail=t.data.ExerciseDetail.exercise,e.exerciseDetail.imagepath=e.exerciseDetail.imagepath+"200x200.jpg?decache="+Math.random(),e.exerciseDetail.tags=t.data.ExerciseDetail.tags,i.postRequest("admin/getTypeDetail/",{typeid:e.exerciseDetail.exercisetypeid}).then(function(i){e.typename=i.data.ExerciseType_Data,e.exerciseDetail.exercisetypename=e.typename.typename}),e.loaded=!1},function(){errorMessage(t,"Please try again later!")})},e.doGetExerciseByID()}]),adminApp.controller("ExerciseEditController",["$q","$scope","requestHandler","Flash","$routeParams","$route","ExerciseService","fileReader","$location",function(e,i,t,a,s,n,r,c,o){var l="";i.title=n.current.title,i.type=n.current.type,i.isNew=n.current.isNew,i.imageUpload=!1,i.inputContainsFile=!0,i.doingUpdate=!1,i.tagTransform=function(e){if(-1==i.tagListArray.indexOf(e)){var t={tagid:null,tagname:e};return t}},i.doGetExcerciseDetails=function(){i.loaded=!0,t.postRequest("admin/getExerciseDetailByadmin/",{exerciseid:s.id}).then(function(e){i.exerciseDetail=e.data.ExerciseDetail.exercise,i.exerciseDetail.type={typeid:i.exerciseDetail.exercisetypeid,typename:i.exerciseDetail.exercisetypename,status:1},i.originalImage=i.exerciseDetail.imageurl+"?decache="+Math.random(),i.exerciseDetail.imageurl=i.exerciseDetail.imageurl+"?decache="+Math.random(),i.exerciseDetail.imagepath=i.exerciseDetail.imagepath+"200x200.jpg?decache="+Math.random(),i.exerciseDetail.tags=e.data.ExerciseDetail.tags,i.exerciseDetail.met=i.exerciseDetail.MET,l=angular.copy(i.exerciseDetail),i.loaded=!1},function(){errorMessage(a,"Please try again later!")})},i.doGetExcerciseTypeList=function(){t.getRequest("admin/listofTypes/","").then(function(e){i.typeListForDropDown=e.data.ExerciseType_Data},function(){errorMessage(a,"Please try again later!")})},i.getFile=function(){i.progress=0,c.readAsDataUrl(i.file,i).then(function(e){i.exerciseDetail.exerciseimage=e,i.inputContainsFile=!1})},i.$on("fileProgress",function(e,t){i.progress=t.loaded/t.total}),i.doRefreshPreview=function(){i.exerciseDetail.exerciseimage=i.exerciseDetail.imagepath,i.inputContainsFile=!0},i.doUpdateExerciseImage=function(){i.imageUpload=!0,i.exerciseDetail.imagepath=i.exerciseDetail.exerciseimage},i.doUpdateExerciseDetail=function(){i.doingUpdate=!0,i.spinner=!0;var s={};s.exerciseid=i.exerciseDetail.exerciseid,s.exercisename=i.exerciseDetail.exercisename,i.imageUpload&&(s.imageurl=i.exerciseDetail.exerciseimage),s.typeid=i.exerciseDetail.type.typeid,s.MET=i.exerciseDetail.met;var n,c=[];$.each(i.exerciseDetail.tags,function(e,i){null!=i.tagid?c.push(parseInt(i.tagid)):(n=r.insertTag(i.tagname),n.then(function(e){c.push(e)}))}),s.tagid=c,e.all([n]).then(function(){t.putRequest("admin/updateExercise/",s).then(function(e){1==e.data.Response_status&&(successMessage(a,"Exercise Updated Successfully!"),o.path("exercise"),i.doingUpdate=!1,i.spinner=!1)},function(){errorMessage(a,"Please Try Again Later!"),i.doingUpdate=!1,i.spinner=!1})})},i.doAddExerciseDetail=function(){i.doingUpdate=!0,i.spinner=!0;var n={};n.exercisename=i.exerciseDetail.exercisename,i.imageUpload&&(n.imageurl=i.exerciseDetail.exerciseimage),n.typeid=i.exerciseDetail.type.typeid,n.MET=parseInt(i.exerciseDetail.met);var c,l=[];$.each(i.exerciseDetail.tags,function(e,i){null!=i.tagid?l.push(parseInt(i.tagid)):(c=r.insertTag(i.tagname),c.then(function(e){l.push(e)}))}),n.tagid=l,e.all([c]).then(function(){console.log(n),t.postRequest("admin/insertExercise/",n).then(function(e){1==e.data.Response_status&&(successMessage(a,"Exercise Added Successfully!"),o.path("exercise"),i.doingUpdate=!1,i.spinner=!1)},function(){errorMessage(a,"Please Try Again Later!"),i.doingUpdate=!1,i.spinner=!1}),null!=s.id&&i.doApproveExerciseSuggestion()})},i.doApproveExerciseSuggestion=function(){i.loaded=!0,t.postRequest("admin/approveExerciseSuggestion/",{suggestionid:s.id}).then(function(){i.doGetAllExerciseSuggestion(),successMessage(a,"Successfully Updated")},function(){errorMessage(a,"Please try again later!")})},i.isClean=function(){return angular.equals(l,i.exerciseDetail)},i.doSetExcerciseDetails=function(){i.exerciseDetail={},i.loaded=!0,i.exerciseDetail.imagepath="../../images/No_image_available.jpg",null!=s.id?(i.suggestionname=function(){t.postRequest("admin/getExerciseSuggestionDetail/",{suggestionid:s.id}).then(function(e){i.exerciseDetail.exercisename=e.data.Exercise_Suggestion_Data.exercisename},function(){errorMessage(a,"Please try again later!")})},i.suggestionname()):i.exerciseDetail.exercisename=null,i.loaded=!1},i.tagListArray=[];var d=r.doGetTags();d.then(function(e){i.exerciseTagList=e,$.each(i.exerciseTagList,function(e,t){i.tagListArray.push(t.tagname)})}),e.all([d]).then(function(){1==i.type?(i.doGetExcerciseTypeList(),i.doSetExcerciseDetails()):2==i.type&&(i.doGetExcerciseTypeList(),i.doGetExcerciseDetails())})}]),adminApp.directive("ngFileSelect",function(){return{link:function(e,i){i.bind("change",function(i){e.file=(i.srcElement||i.target).files[0],e.getFile()})}}}),adminApp.filter("trusted",["$sce",function(e){return function(i){return e.trustAsResourceUrl(i)}}]),adminApp.filter("html",["$sce",function(e){return function(i){return e.trustAsHtml(i)}}]),adminApp.directive("validFile",function(){return{require:"ngModel",link:function(e,i,t,a){i.bind("change",function(){e.$apply(function(){a.$setViewValue(i.val()),a.$render()})})}}}),adminApp.filter("startsWithLetterExercise",function(){return function(e,i){var t=[],a=new RegExp(i,"i");if(e)for(var s=0;s<e.length;s++){var n=e[s];(a.test(n.exercisename)||a.test(n.type))&&t.push(n)}else;return t}});