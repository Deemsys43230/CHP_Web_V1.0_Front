var adminApp=angular.module("adminApp",["ngRoute","oc.lazyLoad","requestModule","flash","ngAnimate","ui.select","foodServiceModule"]);adminApp.controller("FoodUploadController",["$scope","FileUploader",function(o,e,t){var n=e.uploader=new t({url:"upload.php"});n.filters.push({name:"customFilter",fn:function(){return this.queue.length<10}}),n.onWhenAddingFileFailed=function(o,e,t){console.info("onWhenAddingFileFailed",o,e,t)},n.onAfterAddingFile=function(o){console.info("onAfterAddingFile",o)},n.onAfterAddingAll=function(o){console.info("onAfterAddingAll",o)},n.onBeforeUploadItem=function(o){console.info("onBeforeUploadItem",o)},n.onProgressItem=function(o,e){console.info("onProgressItem",o,e)},n.onProgressAll=function(o){console.info("onProgressAll",o)},n.onSuccessItem=function(o,e,t,n){console.info("onSuccessItem",o,e,t,n)},n.onErrorItem=function(o,e,t,n){console.info("onErrorItem",o,e,t,n)},n.onCancelItem=function(o,e,t,n){console.info("onCancelItem",o,e,t,n)},n.onCompleteItem=function(o,e,t,n){console.info("onCompleteItem",o,e,t,n)},n.onCompleteAll=function(){console.info("onCompleteAll")},console.info("uploader",n)}]),adminApp.controller("FoodController",function(o,e,t){o.activeClass={foodlist:"active"},o.sortfoodidicon="fa fa-caret-down",o.sortfoodnameicon="fa fa-caret-down",o.sortFoodId=function(){o.sortKey="foodid",o.reverse=!o.reverse,"fa fa-caret-down"==o.sortfoodidicon?o.sortfoodidicon="fa fa-caret-up":o.sortfoodidicon="fa fa-caret-down"},o.sortFoodName=function(){o.sortKey="foodname",o.reverse=!o.reverse,"fa fa-caret-down"==o.sortfoodnameicon?o.sortfoodnameicon="fa fa-caret-up":o.sortfoodnameicon="fa fa-caret-down"},o.doGetAllFoodItems=function(){return o.loaded=!0,e.getRequest("admin/getFoodList/","").then(function(e){o.foodList=e.data.Food_Data,o.paginationLoad=!0,o.loaded=!1},function(){})},o.doEnableDisable=function(n){"none"!=$(".search-list-form").css("display")&&($(".search-list-form").hide(),$(".search-list-form").show(2400)),e.postRequest("admin/enableordisableFood/",{foodid:n}).then(function(e){if(1==e.data.Response_status){var n=o.doGetAllFoodItems();n.then(function(){successMessage(t,"Successfully Updated")})}else if(0==e.data.Response_status){var n=o.doGetAllFoodItems();n.then(function(){errorMessage(t,"Food used by users")})}},function(){errorMessage(t,"Please Try Again Later")})},o.init=function(){o.paginationLoad=!1,o.doGetAllFoodItems()},$(".show-list-search").click(function(){$(".search-list-form").toggle(300),$(".search-list-form input").focus()})}),adminApp.controller("FoodDetailsViewController",function(o,e,t){o.doGetFoodDetails=function(){e.postRequest("getFoodDetailByadmin/",{foodid:t.id}).then(function(e){o.foodDetails=e.data.Food_Data,o.foodDetails.foodImagePath=o.foodDetails.foodImagePath+"200x200.jpg?decache="+Math.random(),1==o.foodDetails.notobesity?(o.foodDetails.notSuitableFor="Obesity",1==o.foodDetails.notdiabetes&&(o.foodDetails.notSuitableFor+=", Diabetes")):1==o.foodDetails.notdiabetes?o.foodDetails.notSuitableFor="Diabetes":o.foodDetails.notSuitableFor="-"},function(){alert("Not able to pull Food Measure List")})},o.doGetFoodDetails()}),adminApp.controller("FoodDetailsEditController",function(o,e,t,n,i,a,s,d,l){var r="";e.title=s.current.title,e.type=s.current.type,e.isNew=s.current.isNew,e.imageUpload=!1,e.inputContainsFile=!0,e.doingUpdate=!1,e.tagTransform=function(o){if(-1==e.tagListArray.indexOf(o)){var t={tagid:null,tagname:o};return t}},e.doGetFoodDetails=function(){t.postRequest("getFoodDetailByadmin/",{foodid:i.id}).then(function(o){e.foodDetails=o.data.Food_Data,e.foodDetails.foodImagePath=e.foodDetails.foodImagePath+"200x200.jpg?decache="+Math.random(),e.foodDetails.sessionSet=n.setSessionValues(e.foodDetails.sessionid);var t=n.doGetMeasures(e.foodDetails.measureid);t.then(function(o){e.foodMeasureListAll=o}),e.foodDetails.regionid=e.foodDetails.regionid.regionid,r=angular.copy(e.foodDetails),console.log(e.foodDetails)},function(){alert("Not able to pull Food Measure List")})},e.getFile=function(){e.progress=0,d.readAsDataUrl(e.file,e).then(function(o){e.foodDetails.foodimage=o,e.inputContainsFile=!1})},e.$on("fileProgress",function(o,t){e.progress=t.loaded/t.total}),e.doRefreshPreview=function(){e.foodDetails.foodimage=e.foodDetails.foodImagePath,e.inputContainsFile=!0},e.doUpdateFoodImage=function(){e.imageUpload=!0,e.foodDetails.foodImagePath=e.foodDetails.foodimage},e.doUpdateFoodDetails=function(){e.doingUpdate=!0,e.spinner=!0,e.foodDetails.sessionid=n.getSessionArray(e.foodDetails.sessionSet),e.foodDetails.categoryid=n.getCategoryArray(e.foodDetails.categoryid),e.imageUpload||delete e.foodDetails.foodimage,delete e.foodDetails.foodImagePath;var i,s=[];$.each(e.foodDetails.tagid,function(o,e){null!=e.tagid?s.push(parseInt(e.tagid)):(i=n.insertTag(e.tagname),i.then(function(o){s.push(o)}))}),e.foodDetails.tagid=s,e.foodDetails.regionid=e.foodDetails.regionid,e.foodDetails.measuredata=e.foodDetails.measureid,o.all([i]).then(function(){t.putRequest("admin/updateFood/",e.foodDetails).then(function(o){console.log(e.foodDetails),1==o.data.Response_status&&(successMessage(a,"Food Updated Successfully!"),e.doGetFoodDetails(),l.path("food"),e.spinner=!1,e.doingUpdate=!1)},function(){alert("Not able to pull Food Tag"),e.spinner=!1,e.doingUpdate=!1})})},e.doSetFoodDetails=function(){e.imageAdded=!0,e.foodDetails={},e.foodDetails.measureid=[],e.foodDetails.sessionid=[],e.foodDetails.regionid="1",null!=i.id?(e.suggestionname=function(){t.postRequest("admin/getFoodSuggestionDetail/",{suggestionid:i.id}).then(function(o){e.foodDetails.foodname=o.data.Food_Suggestion_Data.foodname},function(){errorMessage(a,"Please try again later!")})},e.suggestionname()):e.foodDetails.foodname=null,e.foodDetails.foodImagePath="../../images/No_image_available.jpg",e.foodDetails.sessionSet=n.setSessionValues(e.foodDetails.sessionid);var o=n.doGetMeasures(e.foodDetails.measureid);o.then(function(o){e.foodMeasureListAll=o})},e.doAddFoodDetails=function(){e.doingUpdate=!0,e.spinner=!0,e.foodDetails.sessionid=n.getSessionArray(e.foodDetails.sessionSet),e.foodDetails.categoryid=n.getCategoryArray(e.foodDetails.categoryid),e.imageUpload||delete e.foodDetails.foodimage;var s,d=[];$.each(e.foodDetails.tagid,function(o,e){null!=e.tagid?d.push(parseInt(e.tagid)):(s=n.insertTag(e.tagname),s.then(function(o){d.push(o)}))}),e.foodDetails.tagid=d,e.foodDetails.measuredata=e.foodDetails.measureid,e.foodDetails.regionid=e.foodDetails.regionid,o.all([s]).then(function(){t.postRequest("admin/insertFood/",e.foodDetails).then(function(o){1==o.data.Response_status&&(successMessage(a,"Food Added Successfully!"),e.doingUpdate=!1,e.spinner=!1,l.path("food"))},function(){e.doingUpdate=!1,e.spinner=!1,errorMessage(a,"Try Again Later!")}),null!=i.id&&e.doApproveFoodSuggestion()})},e.doApproveFoodSuggestion=function(){e.loaded=!0,t.postRequest("admin/approveFoodSuggestion/",{suggestionid:i.id}).then(function(){e.loaded=!1,e.doGetAllFoodSuggestion(),successMessage(a,"Successfully Updated")},function(){errorMessage(a,"Please try again later!")})},e.isClean=function(){return console.log(angular.equals(r,e.foodDetails)),angular.equals(r,e.foodDetails)},e.doAddNewMeasureMinerals=function(o,t){e.foodDetails.measureid=n.doAddMeasureMinerals(o,t,e.foodDetails.measureid)};var f=n.doGetCategories();f.then(function(o){e.foodCategoryListAll=o}),e.tagListArray=[];var u=n.doGetTags();u.then(function(o){e.foodTagList=o,$.each(e.foodTagList,function(o,t){e.tagListArray.push(t.tagname)})}),o.all([f,u]).then(function(){1==e.type?e.doSetFoodDetails():2==e.type&&e.doGetFoodDetails()})}),adminApp.directive("ngFileSelect",function(){return{link:function(o,e){e.bind("change",function(e){o.file=(e.srcElement||e.target).files[0],o.getFile()})}}}),adminApp.filter("trusted",["$sce",function(o){return function(e){return o.trustAsResourceUrl(e)}}]),adminApp.controller("FoodCateogryController",["$scope",function(o){o.activeClass={category:"active"}}]),adminApp.filter("propsFilter",function(){return function(o,e){var t=[];return angular.isArray(o)?o.forEach(function(o){for(var n=!1,i=Object.keys(e),a=0;a<i.length;a++){var s=i[a],d=e[s].toLowerCase();if(-1!==o[s].toString().toLowerCase().indexOf(d)){n=!0;break}}n&&t.push(o)}):t=o,t}}),adminApp.directive("validFile",function(){return{require:"ngModel",link:function(o,e,t,n){e.bind("change",function(){o.$apply(function(){n.$setViewValue(e.val()),n.$render()})})}}}),adminApp.filter("startsWithLetterFood",function(){return function(o,e){var t=[],n=new RegExp(e,"i");if(o)for(var i=0;i<o.length;i++){var a=o[i];(n.test(a.foodname)||n.test(a.category)||n.test(a.session)||n.test(a.region))&&t.push(a)}else;return t}});